<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>æ‘„åƒå¤´æµ‹è¯•</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f0f0f0; }
        .container { max-width: 640px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        h1 { color: #333; }
        video { width: 100%; max-width: 320px; border: 2px solid #667eea; border-radius: 8px; }
        .btn { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }
        .btn-start { background: #667eea; color: white; }
        .btn-stop { background: #ff6b6b; color: white; }
        #status { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .error { background: #ffcccc; color: #cc0000; }
        .success { background: #ccffcc; color: #006600; }
        select { padding: 8px; font-size: 14px; width: 100%; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“· æ‘„åƒå¤´æµ‹è¯•</h1>
        
        <p><strong>æ­¥éª¤ï¼š</strong></p>
        <ol>
            <li>åœ¨ä¸‹æ–¹é€‰æ‹©æ‘„åƒå¤´è®¾å¤‡</li>
            <li>ç‚¹å‡»"å¼€å¯æ‘„åƒå¤´"</li>
            <li>å…è®¸æµè§ˆå™¨è®¿é—®æ‘„åƒå¤´çš„è¯·æ±‚</li>
        </ol>
        
        <h3>é€‰æ‹©è®¾å¤‡</h3>
        <select id="cameraList">
            <option value="">-- ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®è·å–è®¾å¤‡åˆ—è¡¨ --</option>
        </select>
        
        <h3>è§†é¢‘é¢„è§ˆ</h3>
        <video id="video" autoplay playsinline muted></video>
        
        <div style="margin: 15px 0;">
            <button class="btn btn-start" onclick="startCamera()">ğŸ“· å¼€å¯æ‘„åƒå¤´</button>
            <button class="btn btn-stop" onclick="stopCamera()">â¹ï¸ åœæ­¢</button>
        </div>
        
        <div id="status"></div>
        
        <h3>æ—¥å¿—</h3>
        <div id="log" style="background: #f5f5f5; padding: 10px; border-radius: 5px; font-size: 12px; max-height: 200px; overflow-y: auto;"></div>
    </div>

    <script>
        let stream = null;
        const video = document.getElementById('video');
        const status = document.getElementById('status');
        const logDiv = document.getElementById('log');
        
        function log(msg) {
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML = `[${time}] ${msg}<br>` + logDiv.innerHTML;
        }
        
        function showStatus(msg, type) {
            status.innerHTML = msg;
            status.className = type;
        }
        
        async function getDevices() {
            log('æ­£åœ¨è·å–è®¾å¤‡åˆ—è¡¨...');
            try {
                // å…ˆè¯·æ±‚æƒé™æ‰èƒ½è·å–è®¾å¤‡æ ‡ç­¾
                await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                
                const devices = await navigator.mediaDevices.enumerateDevices();
                const cameras = devices.filter(d => d.kind === 'videoinput');
                const mics = devices.filter(d => d.kind === 'audioinput');
                
                const select = document.getElementById('cameraList');
                select.innerHTML = '';
                
                cameras.forEach((cam, i) => {
                    const opt = document.createElement('option');
                    opt.value = cam.deviceId;
                    opt.text = cam.label || `æ‘„åƒå¤´ ${i + 1}`;
                    select.appendChild(opt);
                });
                
                log(`æ‰¾åˆ° ${cameras.length} ä¸ªæ‘„åƒå¤´, ${mics.length} ä¸ªéº¦å…‹é£`);
                showStatus(`æ‰¾åˆ° ${cameras.length} ä¸ªæ‘„åƒå¤´`, 'success');
                
                // å¦‚æœåªæœ‰ä¸€ä¸ªæ‘„åƒå¤´ï¼Œç›´æ¥å¼€å¯
                if (cameras.length === 1) {
                    startCamera();
                }
            } catch (err) {
                log('è·å–è®¾å¤‡å¤±è´¥: ' + err.message);
                showStatus('è·å–è®¾å¤‡å¤±è´¥: ' + err.message, 'error');
            }
        }
        
        async function startCamera() {
            const deviceId = document.getElementById('cameraList').value;
            
            log('æ­£åœ¨å¼€å¯æ‘„åƒå¤´...');
            showStatus('æ­£åœ¨å¼€å¯æ‘„åƒå¤´...', '');
            
            try {
                const constraints = {
                    video: {
                        width: { ideal: 640 },
                        height: { ideal: 480 },
                        facingMode: 'user'
                    }
                };
                
                if (deviceId) {
                    constraints.video.deviceId = { exact: deviceId };
                }
                
                stream = await navigator.mediaDevices.getUserMedia(constraints);
                
                video.srcObject = stream;
                
                log('æ‘„åƒå¤´å¼€å¯æˆåŠŸï¼');
                showStatus('âœ… æ‘„åƒå¤´å·²å¼€å¯', 'success');
                
                // å°è¯•è·å–è®¾å¤‡åˆ—è¡¨
                getDevices();
                
            } catch (err) {
                log('å¼€å¯å¤±è´¥: ' + err.message);
                showStatus('âŒ å¼€å¯å¤±è´¥: ' + err.message, 'error');
                
                // å¦‚æœæ²¡æœ‰è®¾å¤‡åˆ—è¡¨ï¼Œæç¤ºè·å–
                if (err.name === 'NotAllowedError') {
                    alert('è¯·å…è®¸æµè§ˆå™¨è®¿é—®æ‘„åƒå¤´æƒé™ï¼');
                }
            }
        }
        
        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
                stream = null;
            }
            video.srcObject = null;
            log('æ‘„åƒå¤´å·²åœæ­¢');
            showStatus('æ‘„åƒå¤´å·²åœæ­¢', '');
        }
        
        // é¡µé¢åŠ è½½æ—¶è·å–è®¾å¤‡
        getDevices();
    </script>
</body>
</html>
